<div class="show-list-page">
  <%# â”€â”€ HEADER â”€â”€ %>
  <div class="show-list-header px-4 pt-4 pb-3">
    <%= link_to lists_path, class: "back-link" do %>
      <i class="fa-solid fa-chevron-left me-1"></i>Back
    <% end %>
    <h1 class="show-list-title mt-3">ğŸ›’ <%= @list.name %></h1>
  </div>

  <%# â”€â”€ ADD ITEM FORM â”€â”€ %>
  <div class="px-4 mb-3">
    <%= form_with url: attach_list_items_path(@list),
                  scope: :item,
                  method: :post,
                  id: "new_item_form",
                  class: "add-item-form" do %>
      <%= label_tag :query, "Add an Item", class: "visually-hidden" %>
      <%= text_field_tag :query,
          params[:query],
          class: "add-item-input",
          placeholder: "Add an itemâ€¦" %>
      <%= submit_tag "+",
          name: "",
          class: "add-item-btn" %>
    <% end %>
  </div>

  <%# â”€â”€ ITEMS â”€â”€ %>
  <div class="lists-body px-4 pb-5">
    <div class="list-grouped-card mb-4" id="grouped-items-container"> <%#  we can add some style here%>
      <%= render "items/grouped_items", items: @items, list: @list %>
      <% if @items.empty? %>
        <div id="empty-state" class="lists-empty text-center py-5">
          <div class="empty-icon">ğŸ¥¡</div>
          <p class="mt-3 text-muted">No items yet.<br>
            Add your first one above!</p>
        </div>
      <% end %>
    </div>

    <div class="list-total-card mt-4 p-3 d-flex justify-content-between align-items-center">
      <span class="total-label">Total</span>
      <% list_total = @items.select(&:price).sum { |item| item.price.price_with_tax * item.quantity } %>
      <span id="list_total" class="total-price">Â¥<%= list_total %></span>
    </div>
  </div>

  <%# â”€â”€ MAP â”€â”€ %>
  <div class="px-4 mb-5">
    <div class="map-card">
      <div class="map-card-header">
        <span>ğŸ—ºï¸</span>
        <span class="map-card-title">Shopping Route</span>
        <% if @stores.present? %>
          <span class="map-card-badge"><%= @stores.length %> <%= @stores.length == 1 ? "stop" : "stops" %></span>
        <% end %>
      </div>
      <% if @stores.present? && @items.present? %>
        <div id="map"
            style="height: 280px;"
            data-controller="map"
            data-map-token-value="<%= ENV['MAPBOX_TOKEN'] %>"
            data-map-stores-value="<%= @stores.each { |s| { name: s.name, address: s.address, latitude: s.latitude, longitude: s.longitude } }.to_json %>"
            data-map-all-selected-value="<%= @all_selected %>">
        </div>
      <% else %>
        <div id="map"
            style="height: 280px;"
            data-controller="map"
            data-map-token-value="<%= ENV['MAPBOX_TOKEN'] %>">
        </div>
      <% end %>
    </div>
  </div>
</div>
